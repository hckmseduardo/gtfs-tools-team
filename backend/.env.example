# ============================================================================
# Azure Key Vault Configuration (Recommended for Production)
# ============================================================================
# Enable Key Vault for secure secrets management
# When enabled, sensitive secrets are fetched from Azure Key Vault instead of .env
USE_KEY_VAULT=false
AZURE_KEY_VAULT_URL=https://your-keyvault-name.vault.azure.net/

# Azure Authentication (for Key Vault access - only needed for Service Principal auth)
# Option A: Managed Identity (recommended when running in Azure - no credentials needed)
# Option B: Service Principal (for local development - uncomment lines below)
# AZURE_TENANT_ID=your-tenant-id
# AZURE_CLIENT_ID=your-client-id
# AZURE_CLIENT_SECRET=your-client-secret

# ============================================================================
# Database Configuration
# ============================================================================
# NOTE: When USE_KEY_VAULT=true, this value is fetched from Key Vault as "database-url"
DATABASE_URL=postgresql+asyncpg://gtfs_user:gtfs_password@localhost:5432/gtfs_editor
DATABASE_POOL_SIZE=20
DATABASE_MAX_OVERFLOW=10

# ============================================================================
# Redis Configuration
# ============================================================================
# NOTE: When USE_KEY_VAULT=true, this value is fetched from Key Vault as "redis-url"
REDIS_URL=redis://localhost:6379/0

# ============================================================================
# Celery Configuration
# ============================================================================
# NOTE: When USE_KEY_VAULT=true, these are fetched from Key Vault
CELERY_BROKER_URL=redis://localhost:6379/1
CELERY_RESULT_BACKEND=redis://localhost:6379/2

# ============================================================================
# JWT Configuration
# ============================================================================
# NOTE: When USE_KEY_VAULT=true, SECRET_KEY is fetched from Key Vault as "secret-key"
SECRET_KEY=your-secret-key-change-this-in-production
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# ============================================================================
# Microsoft Entra ID Configuration (RECOMMENDED - same as PortfolioInvestments)
# ============================================================================
# This is the primary authentication configuration. Uses standard Azure AD OAuth.
# Copy these values from your app registration in Azure Portal.
ENTRA_CLIENT_ID=your-client-id
ENTRA_CLIENT_SECRET=your-client-secret
ENTRA_TENANT_ID=your-tenant-id
# Optional: Override the default authority URL (usually auto-constructed from tenant ID)
# ENTRA_AUTHORITY=https://login.microsoftonline.com/your-tenant-id
# Default redirect URI for OAuth callback
ENTRA_REDIRECT_URI=http://localhost:5173/auth/callback
# Comma-separated list of allowed redirect URIs for multi-domain support
ENTRA_ALLOWED_REDIRECT_URIS=http://localhost:5173/auth/callback,http://localhost:3000/auth/callback,http://localhost:4000/api/v1/auth/entra/callback
# OAuth scopes (MSAL automatically adds openid, profile, email)
ENTRA_SCOPES=User.Read

# ============================================================================
# Legacy Azure AD Configuration (kept for backward compatibility)
# ============================================================================
# These are deprecated - use ENTRA_* variables above instead
AZURE_AD_TENANT_ID=
AZURE_AD_CLIENT_ID=
AZURE_AD_CLIENT_SECRET=
AZURE_AD_AUTHORITY=

# ============================================================================
# Legacy Azure AD B2C Configuration (kept for backward compatibility)
# ============================================================================
# These are deprecated - use ENTRA_* variables above instead
AZURE_B2C_TENANT_NAME=
AZURE_B2C_TENANT_ID=
AZURE_B2C_CLIENT_ID=
AZURE_B2C_CLIENT_SECRET=
AZURE_B2C_SIGNUP_SIGNIN_FLOW=B2C_1_signupsignin1
AZURE_B2C_PASSWORD_RESET_FLOW=B2C_1_passwordreset1
AZURE_B2C_ENDPOINT_TYPE=tenant
AZURE_B2C_ALLOW_COMMON_TENANT=false

# ============================================================================
# Email Configuration (Microsoft Graph API)
# ============================================================================
# Enable email sending for invitations and notifications
# Uses Microsoft Graph API with your M365 mailbox or shared mailbox
EMAIL_ENABLED=false
# The M365 email address that will send emails (must be a mailbox in the tenant)
# Can be a user mailbox (with M365 license) or a shared mailbox (free)
EMAIL_SENDER_ADDRESS=your-email@yourdomain.com
EMAIL_SENDER_NAME=GTFS Editor

# Optional: Use a separate app registration for email sending
# If not set, uses AZURE_AD credentials above
# This is useful when your Azure AD tenant is different from where the mailbox lives
# EMAIL_TENANT_ID=your-email-tenant-id
# EMAIL_CLIENT_ID=your-email-app-client-id
# EMAIL_CLIENT_SECRET=your-email-app-client-secret

# Frontend URL for links in emails (e.g., invitation accept links)
FRONTEND_URL=http://localhost:5173

# ============================================================================
# Application Configuration
# ============================================================================
# These non-sensitive values typically stay in .env
ENVIRONMENT=development
DEBUG=true
LOG_LEVEL=INFO
ALLOWED_HOSTS=localhost,127.0.0.1

# ============================================================================
# CORS Configuration
# ============================================================================
CORS_ORIGINS=http://localhost:5173,http://localhost:3000

# ============================================================================
# File Upload Configuration
# ============================================================================
MAX_UPLOAD_SIZE_MB=100
UPLOAD_DIRECTORY=/tmp/gtfs-uploads

# ============================================================================
# Migration to Key Vault
# ============================================================================
# To migrate your secrets to Azure Key Vault:
# 1. Create a Key Vault in Azure
# 2. Set AZURE_KEY_VAULT_URL above
# 3. Run: python scripts/migrate_to_keyvault.py --dry-run
# 4. Review the output, then run: python scripts/migrate_to_keyvault.py
# 5. Set USE_KEY_VAULT=true
# 6. Remove sensitive values from this file (they're now in Key Vault!)
#
# See backend/AZURE_KEY_VAULT_SETUP.md for detailed instructions
